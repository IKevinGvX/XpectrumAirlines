@page
@model Xpectrum_Structure.Pages.AgenteDeVuelos.GestionPasajerosModel
@{
    ViewData["Title"] = "Gestión de Pasajeros";
    Layout = "_Layout";
}



<div class="uk-container uk-margin-top">
    <div class="table-container uk-animation-slide-top-small">
        <div class="table-header">
            <h3><span uk-icon="icon: users; ratio: 1.2" class="uk-margin-small-right"></span>Gestión de Pasajeros</h3>
            <div class="table-actions">
                <a href="/AgenteDeVuelos" class="uk-button uk-button-default uk-button-small">
                    <span uk-icon="icon: arrow-left"></span> Volver
                </a>
                <button class="uk-button uk-button-primary uk-button-small" uk-toggle="target: #modal-agregar">
                    <span uk-icon="icon: plus"></span> Nuevo Pasajero
                </button>
                <a href="/AgenteDeVuelos/GestionReserva" class="uk-button uk-button-primary uk-button-small">
                    <span uk-icon="icon: calendar"></span> Nueva Reserva
                </a>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Teléfono</th>
                        <th>Dirección</th>
                        <th>F. Nacimiento</th>
                        <th>Estado</th>
                        <th class="uk-text-center">Acciones</th>
                    </tr>
                </thead>
                    <tbody>
                        @foreach (var pasajero in Model.ListaPasajeros)
                        {
                            <tr>
                                <td>@pasajero.UsuarioId</td>
                                <td>@pasajero.Nombre</td>
                                <td>@pasajero.Email</td>
                                <td>@pasajero.Telefono</td>
                                <td>@(string.IsNullOrEmpty(pasajero.Direccion) ? "-" : pasajero.Direccion)</td>
                                <td>@(pasajero.FechaNacimiento?.ToString("yyyy-MM-dd") ?? "-")</td>
                                
                                <td>@(string.IsNullOrEmpty(pasajero.Estado) ? "-" : pasajero.Estado)</td>
                                <td class="uk-text-center">
                                    <div class="action-buttons">
                                        <button class="uk-button uk-button-small uk-button-secondary" uk-toggle="target: #modal-editar-@pasajero.UsuarioId">
                                            <span uk-icon="icon: pencil"></span>
                                        </button>
                                        <button class="uk-button uk-button-small uk-button-danger" onclick="eliminarPasajero('@pasajero.UsuarioId')">
                                            <span uk-icon="icon: trash"></span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            
                            <!-- Modal para editar pasajero -->
                            <div id="modal-editar-@pasajero.UsuarioId" uk-modal>
                                <div class="uk-modal-dialog uk-modal-body">
                                    <button class="uk-modal-close-default" type="button" uk-close></button>
                                    <h3 class="uk-modal-title">Editar Pasajero</h3>
                                    <form method="post" asp-page-handler="Actualizar">
                                        <input type="hidden" name="id" value="@pasajero.UsuarioId" />
                                        <div class="uk-margin">
                                            <label class="uk-form-label">Nombre</label>
                                            <input class="uk-input" name="Nombre" value="@pasajero.Nombre" required />
                                        </div>
                                        <div class="uk-margin">
                                            <label class="uk-form-label">Email</label>
                                            <input class="uk-input" name="Email" value="@pasajero.Email" required />
                                        </div>
                                        <div class="uk-margin">
                                            <label class="uk-form-label">Teléfono</label>
                                            <input class="uk-input" name="Telefono" value="@pasajero.Telefono" />
                                        </div>
                                        <div class="uk-margin">
                                            <label class="uk-form-label">Dirección</label>
                                            <input class="uk-input" name="Direccion" value="@pasajero.Direccion" />
                                        </div>
                                        <div class="uk-margin">
                                            <label class="uk-form-label">F. Nacimiento</label>
                                            <input class="uk-input" type="date" name="FechaNacimiento" 
                                                   value="@(pasajero.FechaNacimiento?.ToString("yyyy-MM-dd"))" />
                                        </div>
                                        <div class="uk-margin">
                                            <label>
                                                <input class="uk-checkbox" type="checkbox" name="Activo" 
                                                       @(pasajero.Activo ? "checked" : "") /> Activo
                                            </label>
                                        </div>
                                        <div class="uk-margin">
                                            <label class="uk-form-label">Estado</label>
                                            <select class="uk-select" name="Estado">
                                                <option value="Activo" selected="@(pasajero.Estado == "Activo")">Activo</option>
                                                <option value="Inactivo" selected="@(pasajero.Estado == "Inactivo")">Inactivo</option>
                                            </select>
                                        </div>
                                        <div class="uk-margin uk-text-right">
                                            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancelar</button>
                                            <button type="submit" class="uk-button uk-button-primary">Guardar Cambios</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar un nuevo pasajero -->
<div id="modal-agregar" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <h3 class="uk-modal-title">Agregar Nuevo Pasajero</h3>
        <form method="post" asp-page-handler="Agregar">
            <div class="uk-margin">
                <label class="uk-form-label">Nombre Completo</label>
                <input class="uk-input" name="Nombre" required />
            </div>
            <div class="uk-margin">
                <label class="uk-form-label">Correo Electrónico</label>
                <input class="uk-input" type="email" name="Email" required />
            </div>
            <div class="uk-margin">
                <label class="uk-form-label">Teléfono</label>
                <input class="uk-input" name="Telefono" />
            </div>
            <div class="uk-margin">
                <label class="uk-form-label">Dirección</label>
                <textarea class="uk-textarea" name="Direccion" rows="2"></textarea>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label">Fecha de Nacimiento</label>
                <input class="uk-input" type="date" name="FechaNacimiento" />
            </div>
            <div class="uk-margin">
                <label>
                    <input class="uk-checkbox" type="checkbox" name="Activo" checked /> 
                    Activo
                </label>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label">Estado</label>
                <select class="uk-select" name="Estado">
                    <option value="Activo">Activo</option>
                    <option value="Inactivo">Inactivo</option>
                </select>
            </div>
            <div class="uk-margin uk-text-right">
                <button class="uk-button uk-button-default uk-modal-close" type="button">Cancelar</button>
                <button type="submit" class="uk-button uk-button-primary">Agregar</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function eliminarPasajero(id) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar',
                customClass: {
                    confirmButton: 'uk-button uk-button-danger',
                    cancelButton: 'uk-button uk-button-default'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `?handler=Eliminar&id=${id}`;
                }
            });
        }

        // Mostrar notificación de éxito/error
        document.addEventListener('DOMContentLoaded', function() {
            const successMessage = '@(TempData["SuccessMessage"] ?? "")';
            const errorMessage = '@(TempData["ErrorMessage"] ?? "")';
            
            if (successMessage) {
                showNotification('success', successMessage);
            }
            
            if (errorMessage) {
                showNotification('error', errorMessage);
            }
        });
    </script>
}
<style>

.uk-light .uk-button-secondary {
    background-color: #007bff;
    color: #fff;
}
.uk-light .uk-label{
        color: #2ed573;
}
</style>

